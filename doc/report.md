# 验收报告

## 1 风格

### 代码注释

本项目有以下相关注释：

- 类：使用文档字符串进行类的功能说明以及成员方法的功能说明
- 函数：使用文档字符串对函数功能进行说明，有些文档字符串有其他作用的函数使用单行注释在函数前进行功能注释
- 代码段：使用单行注释对部分代码段的功能进行简要说明
- 函数注解：对函数形参与返回值进行类型注解以增强可读性
- 变量注释：对一些有必要的内容进行注释

### 命名

本项目依照 PEP 8 提案（Python 编码风格指南）与 PEP 257 提案（文档字符串约定）进行命名规范，包括以下内容：

- 函数名使用 `lower_case_with_underscores` 样式
- 类名使用大驼峰 `CapitalizedWords` 样式
- 函数或成员方法的文档字符串包括：功能概述、形参含义、返回值含义
- 函数命名使用 `谓语_宾语` 样式
- 变量命名使用 `lower_case_with_underscores` 样式

在使用 `PLY`（Python Lex Yacc）模块进行词法分析与语法分析时，遵循以下命名规范：

- token 以全部大写 `TOKEN` 样式命名
- 正则表达式匹配规则以 `t_func_name` 样式命名
- 语法分析规则以 `p_char_name` 样式命名

### 其他

- 运算符之间的空格增强可读性
- 较长内容的换行书写
- git commit 内容使用插件进行规范化

## 2 设计和实现

### 数据结构

在 `parse.py` 中进行语法分析后产生的语法树数据结构说明如下：

- 语法分析返回的结果是一个 Python 列表，其中的元素为每一个步骤 step
- 每一个步骤 step 是一个 Python 元组
  - 元组的一个元素 first 为该步骤的 ID ，为一个字符串
  - 元组的第二个元素 second 为该步骤包含的所有动作 actions
- 步骤中包含的所有动作 actions 为一个 Python 列表，其中的每一个元素都是 speak, listen, branch, silence, default, exit 之一
- 每一个动作都是一个 Python 元组
  - 元组第一个元素是一个字符串，指示该动作，为 speak, listen, branch, silence, default, exit 之一
  - 元组第二个元素是该动作相关的信息，详细内容如下
    - speak ：一个 Python 列表，元素均为字符串，可能有字符串字面量也有变量
    - listen ：一个 Python 二元组，第一个元素为一个整数表示开始时间，第二个元素为一个整数表示结束时间
    - branch ：一个 Python 字典，key 为语言识别中包含的字符串，value 为下一个步骤的 step ID
    - silence ：一个字符串，沉默步骤的 step ID
    - default ：一个字符串，默认步骤的 step ID
    - exit ：空，标识这个步骤后退出

在 `interpreter.py` 中进行语义分析后构建的运行环境数据结构说明如下：

Environment 类

Step 类

### 模块划分

本项目模块分为以下部分：

- `lex.py` 对脚本进行词法分析
- `parse.py` 对脚本进行语法分析并返回语法树数据结构
- `interpreter.py` 使用语法树构建用于执行的运行环境数据结构，并进行语义正确性检查
- `main.py` 纯命令行界面交互方式的机器人
- `gui.py` 图形化界面交互方式的机器人

### 功能

#### 基础功能

本项目完成了在课题描述中要求的以下基础功能：

- 脚本语言的语法可以自由定义，只要语义上满足描述客服机器人自动应答逻辑的要求
- 纯命令行界面交互方式
- 对不同的脚本范例，解释器执行之后会有不同的行为表现，即生成不同的机器人

#### 拓展功能

除了基础功能，本项目还实现了以下拓展功能：

- 对不符合语义的脚本进行错误提示
- 使用 nicegui 库对脚本生成的机器人对话过程实现图形化操作

### 文档

本项目文档包括以下内容：

- 用户文档
- 开发文档
- 测试文档
- 验收报告（本文档）

## 3 接口

### 程序间接口



### 人机接口





## 4 测试

### 测试桩





### 自动测试脚本






## 5 记法

### 词法

**注意：本项目设计的 DSL 语言不区分大小写，解释器会自动忽略大小写**

token ：

- ID 自定义标识符，用以标识步骤名称
- VAR 变量，以 `$` 开头，用以标识 Speak 中的变量
- STRING 字符串，用 `"` 包含，用以标识 Speak 、Branch 等使用到的字符串
- NUMBER 整数数字，用以标识 Listen 中使用的时间
- COMMENT 单行注释，以 `#` 开头，词法分析中忽略掉注释，不参与语法分析
- INDENT 缩进，每个 Step 顶格开始，里面的所有动作都需要有在新行若干字符的缩进

字面量符号：

- `+` 连接变量与字符串
- `,` 用以分隔 Listen 的开始、结束时间；用以分隔 Branch 的字符串和下一步 ID

保留字：

- step
- speak
- listen
- branch
- silence
- default
- exit

### 语法

定义一个步骤，后面是这个步骤的名字，并在这个步骤内指定相关动作，里面的动作需要换行后缩进：

```bs
Step welcome
    Speak $name + "您好,请问有什么可以帮您?"
    Listen 5, 20
    Branch "投诉", complainProc
    Branch "账单", billProc
    Silence silenceProc
    Default defaultProc
```

`welcome` 是步骤的名字。

定义机器人说话动作，并指定说话内容：

```bs
Speak $name + "您好,请问有什么可以帮您?"
```

后面可以跟一个字符串，也可以设置用户的相关信息变量，由后台读取后返回，不在此项目实现范围内。

定义机器人听话动作，并指定开始与结束的时间：

```bs
Listen 5, 20
```

从第 5 秒开始听，到 20 秒结束。

定义获取到的内容对应的下一步骤的分支，如果客户说的内容有相应的部分，跳转到指定的下一步：

```bs
Branch "投诉", complainProc
```

如果客户说的内容中有“投诉”，跳转到 `complainProc` 步骤。

定义沉默步骤，如果客户在 Listen 中指定的时间内没有识别到说话，跳转到沉默步骤：

```bs
Silence silenceProc
```

如果没有识别到客户说话，跳转到 `silenceProc` 步骤。

定义默认步骤，如果客户说的内容不在分支包含的范围内，跳转到默认步骤：

```bs
Default defaultProc
```

如果客户说的内容不再分支包含的范围内，跳转到 `defaultProc` 步骤。

### 语义

对本项目的 DSL 语言作如下语义规则限制：

- 脚本中必须含有一个名为 `welcome` 的步骤作为起始步骤
- 每个步骤中必须有 `speak` 动作，要么只有一个 `exit` ，要么有其他动作
- 除了 `branch` 动作，其他动作在一个步骤中只能出现一次
